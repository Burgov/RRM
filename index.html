<!DOCTYPE html>
<html>
<head>
    <title></title>
    <script>
        "use strict";
        var Entity = function() {}
        Object.defineProperty(Entity.prototype, '$values', {
            value: {}
        });
        Object.defineProperty(Entity.prototype, '$dirty', {
            value: false,
            writable: true
        });

        var ProjectSchema = function() {
            this.id = {
                get: function() {
                    return this.$values.id;
                },
                transform: function(json) {
                    return json.id;
                }
            }
            this.age = {
                get: function() {
                    return this.$values.age;
                },
                transform: function(json) {
                    var date = new Date(json.created_at);
                    var age = 0;
                    while(date < new Date()) {
                        age++;
                        date.setFullYear(date.getFullYear() + 1);
                    }
                    return age;
                }
            }
            this.name = {
                get: function() {
                    return this.$values.name;
                },
                set: function() {
                    this.$values.name = value;
                },
                transform: function(json) {
                    return json.name;
                },
                reverseTransform: function(json) {
                    json.name = this.name;
                }
            }
        };
        var projectSchema = new ProjectSchema();

        var Project = function() {}
        Project.prototype = Entity.prototype;

        var RRM = function() {

            this.create = function(entityClass, data) {
                var entity = new entityClass;

                for (var i in projectSchema) {
                    var property = projectSchema[i];
                    if (!('transform' in property)) {
                        throw Error('transform is mandatory');
                    }
                    var value = property.transform(data);
                    entity.$values[i] = value;

                    var definition = {};
                    if ('get' in property) {
                        definition.get = function() {
                            return property['get'].apply(entity);
                        }
                    }
                    if ('set' in property) {
                        definition.set = function(value) {
                            return property['set'].apply(entity, value);
                        }
                    }

                    Object.defineProperty(entity, i, definition);
                }

                return entity;
            }
        }

        var rrm = new RRM;

        var project = rrm.create(Project, { id: 1, name: 'Pfdsaroject', created_at: '2010-05-16T00:00:00Z' });

        document.write("id: " + project.id + ", name: " + project.name + ', age:' + project.age);
    </script>
</head>
<body>

</body>
</html>